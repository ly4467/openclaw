import{c as g,v as p,b as x,a as b,w as j,r as c,j as e}from"./main-BPgb0gzG.js";function C(){const{isAuthenticated:n,me:t}=g(),{signIn:r}=p(),a=x(b.tokens.create),s=j.useSearch(),[h,o]=c.useState("Preparingâ€¦"),[i,R]=c.useState(null),m=c.useRef(!1),l=s.redirect_uri??"",f=(L(s.label_b64)??s.label??"CLI token").trim()||"CLI token",u=typeof s.state=="string"?s.state.trim():"",d=c.useMemo(()=>N(l),[l]);return c.useEffect(()=>{m.current},[a,n,f,t,l,d,u]),d?u?e.jsx("main",{className:"section",children:e.jsx("div",{className:"card",children:"Missing VITE_CONVEX_SITE_URL configuration."})}):e.jsx("main",{className:"section",children:e.jsxs("div",{className:"card",children:[e.jsx("h1",{className:"section-title",style:{marginTop:0},children:"CLI login"}),e.jsx("p",{className:"section-subtitle",children:"Missing state."}),e.jsx("p",{className:"section-subtitle",style:{marginBottom:0},children:"Run the CLI again to start a fresh login."})]})}):e.jsx("main",{className:"section",children:e.jsxs("div",{className:"card",children:[e.jsx("h1",{className:"section-title",style:{marginTop:0},children:"CLI login"}),e.jsx("p",{className:"section-subtitle",children:"Invalid redirect URL."}),e.jsx("p",{className:"section-subtitle",style:{marginBottom:0},children:"Run the CLI again to start a fresh login."})]})})}function N(n){if(!n)return!1;let t;try{t=new URL(n)}catch{return!1}if(t.protocol!=="http:")return!1;const r=t.hostname.toLowerCase();return r==="127.0.0.1"||r==="localhost"||r==="::1"||r==="[::1]"}function L(n){if(!n)return null;try{const t=n.replace(/-/g,"+").replace(/_/g,"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"="),a=atob(r),s=new Uint8Array(a.length);for(let i=0;i<a.length;i+=1)s[i]=a.charCodeAt(i);const o=new TextDecoder().decode(s).trim();return o?o.slice(0,80):null}catch{return null}}export{C as component};
