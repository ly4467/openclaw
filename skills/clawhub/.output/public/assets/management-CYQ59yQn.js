import{c as ue,R as he,i as ge,d as pe,u as b,a,b as o,r as c,j as e,L as m,e as je,f as xe,h as Ne,k as ve}from"./main-BPgb0gzG.js";function x(i,f){return i?.trim()||(f?String(f):"unknown")}function we(){const{me:i}=ue(),f=he.useSearch(),u=ge(i),h=pe(i),p=f.skill?.trim(),j=b(a.skills.getBySlugForStaff,u&&p?{slug:p}:"skip"),$=b(a.skills.listRecentVersions,u?{limit:20}:"skip"),N=b(a.skills.listReportedSkills,u?{limit:25}:"skip"),I=b(a.skills.listDuplicateCandidates,u?{limit:20}:"skip"),G=o(a.users.setRole),B=o(a.users.banUser),J=o(a.skills.setBatch),A=o(a.skills.setSoftDeleted),H=o(a.skills.hardDelete),K=o(a.skills.changeOwner),L=o(a.skills.setDuplicate),W=o(a.skills.setOfficialBadge),X=o(a.skills.setDeprecatedBadge),[M,O]=c.useState(""),[T,V]=c.useState(""),[D,Y]=c.useState(""),[Z,ee]=c.useState(""),[y,se]=c.useState(""),[ne,le]=c.useState(""),E=ne.trim(),S=b(a.users.list,h?{limit:200,search:E||void 0}:"skip"),F=j?.skill?._id??null,_=j?.skill?.ownerUserId??null,z=j?.canonical?.skill?.slug??"";if(c.useEffect(()=>{!F||!_||(O(z),V(String(_)))},[z,_,F]),c.useEffect(()=>{const s=setTimeout(()=>ee(D),250);return()=>clearTimeout(s)},[D]),c.useEffect(()=>{const s=setTimeout(()=>le(y),250);return()=>clearTimeout(s)},[y]),!u)return e.jsx("main",{className:"section",children:e.jsx("div",{className:"card",children:"Management only."})});if(!$||!N||!I)return e.jsx("main",{className:"section",children:e.jsx("div",{className:"card",children:"Loading management console…"})});const P=Z.trim().toLowerCase(),C=P?N.filter(s=>{const n=(s.reports??[]).map(d=>d.reason).join(" "),l=(s.reports??[]).map(d=>d.reporterHandle).filter(Boolean).join(" ");return[s.skill.displayName,s.skill.slug,s.owner?.handle,s.owner?.name,n,l].filter(Boolean).join(" ").toLowerCase().includes(P)}):N,ae=C.length===0&&N.length>0?"No matching reports.":"No reports yet.",te=`Showing ${C.length} of ${N.length}`,v=S?.items??[],ie=S?.total??0,re=S?`Showing ${v.length} of ${ie}`:"Loading users…",oe=S?v.length===0?E?"No matching users.":"No users yet.":"":"Loading users…";return e.jsxs("main",{className:"section",children:[e.jsx("h1",{className:"section-title",children:"Management console"}),e.jsx("p",{className:"section-subtitle",children:"Moderation, curation, and ownership tools."}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Reported skills"}),e.jsxs("div",{className:"management-controls",children:[e.jsxs("div",{className:"management-control management-search",children:[e.jsx("span",{className:"mono",children:"Filter"}),e.jsx("input",{type:"search",placeholder:"Search reported skills",value:D,onChange:s=>Y(s.target.value)})]}),e.jsx("div",{className:"management-count",children:te})]}),e.jsx("div",{className:"management-list",children:C.length===0?e.jsx("div",{className:"stat",children:ae}):C.map(s=>{const{skill:n,latestVersion:l,owner:g,reports:d}=s,U=x(g?.handle??null,g?._id??n.ownerUserId),k=d??[];return e.jsxs("div",{className:"management-item",children:[e.jsxs("div",{className:"management-item-main",children:[e.jsx(m,{to:"/$owner/$slug",params:{owner:U,slug:n.slug},children:n.displayName}),e.jsxs("div",{className:"section-subtitle",style:{margin:0},children:["@",g?.handle??g?.name??"user"," · v",l?.version??"—"," ·",n.reportCount??0," report",(n.reportCount??0)===1?"":"s",n.lastReportedAt?` · last ${R(n.lastReportedAt)}`:""]}),k.length>0?e.jsx("div",{className:"management-sublist",children:k.map(r=>e.jsxs("div",{className:"management-report-item",children:[e.jsxs("span",{className:"management-report-meta",children:[R(r.createdAt),r.reporterHandle?` · @${r.reporterHandle}`:""]}),e.jsx("span",{children:r.reason})]},`${r.reporterId}-${r.createdAt}`))}):e.jsx("div",{className:"section-subtitle",style:{margin:0},children:"No report reasons yet."})]}),e.jsxs("div",{className:"management-actions",children:[e.jsx("button",{className:"btn",type:"button",onClick:()=>{A({skillId:n._id,deleted:!n.softDeletedAt})},children:n.softDeletedAt?"Restore":"Hide"}),h?e.jsx("button",{className:"btn",type:"button",onClick:()=>{window.confirm(`Hard delete ${n.displayName}?`)&&H({skillId:n._id})},children:"Hard delete"}):null]})]},n._id)})})]}),e.jsxs("div",{className:"card",style:{marginTop:20},children:[e.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Skill tools"}),p?e.jsxs("div",{className:"section-subtitle",style:{marginTop:8},children:['Managing "',p,'" ·'," ",e.jsx(m,{to:"/management",search:{skill:void 0},children:"Clear selection"})]}):null,e.jsx("div",{className:"management-list",children:p?j===void 0?e.jsx("div",{className:"stat",children:"Loading skill…"}):j?.skill?(()=>{const{skill:s,latestVersion:n,owner:l,canonical:g}=j,d=x(l?.handle??null,l?._id??s.ownerUserId),U=s.moderationStatus??(s.softDeletedAt?"hidden":"active"),k=je(s),r=xe(s),Q=Ne(s),q=ve(s),w=s.ownerUserId??_,ce=l?.handle??l?.name??"user",de=l?.role==="admin",me=u&&w&&w!==i?._id&&(h||!de);return e.jsxs("div",{className:"management-item",children:[e.jsxs("div",{className:"management-item-main",children:[e.jsx(m,{to:"/$owner/$slug",params:{owner:d,slug:s.slug},children:s.displayName}),e.jsxs("div",{className:"section-subtitle",style:{margin:0},children:["@",l?.handle??l?.name??"user"," · v",n?.version??"—"," · updated ",R(s.updatedAt)," · ",U,q.length?` · ${q.join(", ").toLowerCase()}`:""]}),s.moderationFlags?.length?e.jsx("div",{className:"management-tags",children:s.moderationFlags.map(t=>e.jsx("span",{className:"tag",children:t},t))}):null,e.jsxs("div",{className:"management-controls",children:[e.jsxs("label",{className:"management-control",children:[e.jsx("span",{className:"mono",children:"duplicate of"}),e.jsx("input",{className:"search-input",value:M,onChange:t=>O(t.target.value),placeholder:g?.skill?.slug??"canonical slug"})]}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{L({skillId:s._id,canonicalSlug:M.trim()||void 0})},children:"Set duplicate"}),h?e.jsxs("label",{className:"management-control",children:[e.jsx("span",{className:"mono",children:"owner"}),e.jsx("select",{value:T,onChange:t=>V(t.target.value),children:v.map(t=>e.jsxs("option",{value:t._id,children:["@",t.handle??t.name??"user"]},t._id))}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{K({skillId:s._id,ownerUserId:T})},children:"Change owner"})]}):null]})]}),e.jsxs("div",{className:"management-actions",children:[e.jsx(m,{className:"btn",to:"/$owner/$slug",params:{owner:d,slug:s.slug},children:"View"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{A({skillId:s._id,deleted:!s.softDeletedAt})},children:s.softDeletedAt?"Restore":"Hide"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{J({skillId:s._id,batch:k?void 0:"highlighted"})},children:k?"Unhighlight":"Highlight"}),h?e.jsx("button",{className:"btn",type:"button",onClick:()=>{window.confirm(`Hard delete ${s.displayName}?`)&&H({skillId:s._id})},children:"Hard delete"}):null,u?e.jsx("button",{className:"btn",type:"button",disabled:!me,onClick:()=>{!w||w===i?._id||window.confirm(`Ban @${ce} and delete their skills?`)&&B({userId:w})},children:"Ban user"}):null,h?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",type:"button",onClick:()=>{W({skillId:s._id,official:!r})},children:r?"Remove official":"Mark official"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{X({skillId:s._id,deprecated:!Q})},children:Q?"Remove deprecated":"Mark deprecated"})]}):null]})]},s._id)})():e.jsxs("div",{className:"stat",children:['No skill found for "',p,'".']}):e.jsx("div",{className:"stat",children:"Use the Manage button on a skill to open tooling here."})})]}),e.jsxs("div",{className:"card",style:{marginTop:20},children:[e.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Duplicate candidates"}),e.jsx("div",{className:"management-list",children:I.length===0?e.jsx("div",{className:"stat",children:"No duplicate candidates."}):I.map(s=>e.jsxs("div",{className:"management-item",children:[e.jsxs("div",{className:"management-item-main",children:[e.jsx(m,{to:"/$owner/$slug",params:{owner:x(s.owner?.handle??null,s.owner?._id??s.skill.ownerUserId),slug:s.skill.slug},children:s.skill.displayName}),e.jsxs("div",{className:"section-subtitle",style:{margin:0},children:["@",s.owner?.handle??s.owner?.name??"user"," · v",s.latestVersion?.version??"—"," · fingerprint"," ",s.fingerprint?.slice(0,8)]}),e.jsx("div",{className:"management-sublist",children:s.matches.map(n=>e.jsxs("div",{className:"management-subitem",children:[e.jsxs("div",{children:[e.jsx("strong",{children:n.skill.displayName}),e.jsxs("div",{className:"section-subtitle",style:{margin:0},children:["@",n.owner?.handle??n.owner?.name??"user"," ·"," ",n.skill.slug]})]}),e.jsxs("div",{className:"management-actions",children:[e.jsx(m,{className:"btn",to:"/$owner/$slug",params:{owner:x(n.owner?.handle??null,n.owner?._id??n.skill.ownerUserId),slug:n.skill.slug},children:"View"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>{L({skillId:s.skill._id,canonicalSlug:n.skill.slug})},children:"Mark duplicate"})]})]},n.skill._id))})]}),e.jsx("div",{className:"management-actions",children:e.jsx(m,{className:"btn",to:"/$owner/$slug",params:{owner:x(s.owner?.handle??null,s.owner?._id??s.skill.ownerUserId),slug:s.skill.slug},children:"View"})})]},s.skill._id))})]}),e.jsxs("div",{className:"card",style:{marginTop:20},children:[e.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Recent pushes"}),e.jsx("div",{className:"management-list",children:$.length===0?e.jsx("div",{className:"stat",children:"No recent versions."}):$.map(s=>e.jsxs("div",{className:"management-item",children:[e.jsxs("div",{className:"management-item-main",children:[e.jsx("strong",{children:s.skill?.displayName??"Unknown skill"}),e.jsxs("div",{className:"section-subtitle",style:{margin:0},children:["v",s.version.version," · @",s.owner?.handle??s.owner?.name??"user"]})]}),e.jsx("div",{className:"management-actions",children:s.skill?e.jsx(m,{className:"btn",to:"/$owner/$slug",params:{owner:x(s.owner?.handle??null,s.owner?._id??s.skill.ownerUserId),slug:s.skill.slug},children:"View"}):null})]},s.version._id))})]}),h?e.jsxs("div",{className:"card",style:{marginTop:20},children:[e.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Users"}),e.jsxs("div",{className:"management-controls",children:[e.jsxs("div",{className:"management-control management-search",children:[e.jsx("span",{className:"mono",children:"Filter"}),e.jsx("input",{type:"search",placeholder:"Search users",value:y,onChange:s=>se(s.target.value)})]}),e.jsx("div",{className:"management-count",children:re})]}),e.jsx("div",{className:"management-list",children:v.length===0?e.jsx("div",{className:"stat",children:oe}):v.map(s=>e.jsxs("div",{className:"management-item",children:[e.jsx("div",{className:"management-item-main",children:e.jsxs("span",{className:"mono",children:["@",s.handle??s.name??"user"]})}),e.jsxs("div",{className:"management-actions",children:[e.jsxs("select",{value:s.role??"user",onChange:n=>{const l=n.target.value;(l==="admin"||l==="moderator"||l==="user")&&G({userId:s._id,role:l})},children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("button",{className:"btn",type:"button",disabled:s._id===i?._id,onClick:()=>{s._id!==i?._id&&window.confirm(`Ban @${s.handle??s.name??"user"} and delete their skills?`)&&B({userId:s._id})},children:"Ban user"})]})]},s._id))})]}):null]})}function R(i){return new Date(i).toLocaleString()}export{we as component};
