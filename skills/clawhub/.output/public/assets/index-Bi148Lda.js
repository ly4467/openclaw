import{q as k,r as n,u as C,a as S,l as L,j as e,L as b}from"./main-BPgb0gzG.js";import{S as R}from"./SoulCard-Ck3NI4Wo.js";const q=["newest","downloads","stars","name","updated"];function A(a){return typeof a!="string"?"newest":q.includes(a)?a:"newest"}function x(a,l){return a==="asc"||a==="desc"?a:l==="name"?"asc":"desc"}function B(){const a=k.useNavigate(),l=k.useSearch(),c=l.sort??"newest",o=x(l.dir,c),u=l.view??"list",[m,v]=n.useState(l.q??""),d=C(S.souls.list,{limit:500}),f=L(S.seed.ensureSoulSeeds),j=n.useRef(!1),h=n.useRef(null),w=d===void 0;n.useEffect(()=>{v(l.q??"")},[l.q]),n.useEffect(()=>{l.focus==="search"&&h.current&&(h.current.focus(),a({search:s=>({...s,focus:void 0}),replace:!0}))},[l.focus,a]),n.useEffect(()=>{j.current||(j.current=!0,f({}))},[f]);const N=n.useMemo(()=>{const s=m.trim().toLowerCase(),r=d??[];return s?r.filter(t=>t.slug.toLowerCase().includes(s)||t.displayName.toLowerCase().includes(s)?!0:(t.summary??"").toLowerCase().includes(s)):r},[m,d]),p=n.useMemo(()=>{const s=o==="asc"?1:-1,r=[...N];return r.sort((t,i)=>{switch(c){case"downloads":return(t.stats.downloads-i.stats.downloads)*s;case"stars":return(t.stats.stars-i.stats.stars)*s;case"updated":return(t.updatedAt-i.updatedAt)*s;case"name":return(t.displayName.localeCompare(i.displayName)||t.slug.localeCompare(i.slug))*s;default:return(t.createdAt-i.createdAt)*s}}),r},[o,N,c]),g=p.length,y=d?.length;return e.jsxs("main",{className:"section",children:[e.jsxs("header",{className:"skills-header",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"section-title",style:{marginBottom:8},children:"Souls"}),e.jsx("p",{className:"section-subtitle",style:{marginBottom:0},children:w?"Loading souls…":`${g}${typeof y=="number"?` of ${y}`:""} souls.`})]}),e.jsxs("div",{className:"skills-toolbar",children:[e.jsx("div",{className:"skills-search",children:e.jsx("input",{ref:h,className:"skills-search-input",value:m,onChange:s=>{const r=s.target.value,t=r.trim();v(r),a({search:i=>({...i,q:t?r:void 0}),replace:!0})},placeholder:"Filter by name, slug, or summary…"})}),e.jsxs("div",{className:"skills-toolbar-row",children:[e.jsxs("select",{className:"skills-sort",value:c,onChange:s=>{const r=A(s.target.value);a({search:t=>({...t,sort:r,dir:x(t.dir,r)}),replace:!0})},"aria-label":"Sort souls",children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"updated",children:"Recently updated"}),e.jsx("option",{value:"downloads",children:"Downloads"}),e.jsx("option",{value:"stars",children:"Stars"}),e.jsx("option",{value:"name",children:"Name"})]}),e.jsx("button",{className:"skills-dir",type:"button","aria-label":`Sort direction ${o}`,onClick:()=>{a({search:s=>({...s,dir:x(s.dir,c)==="asc"?"desc":"asc"}),replace:!0})},children:o==="asc"?"↑":"↓"}),e.jsx("button",{className:`skills-view${u==="cards"?" is-active":""}`,type:"button",onClick:()=>{a({search:s=>({...s,view:s.view==="cards"?void 0:"cards"}),replace:!0})},children:u==="cards"?"List":"Cards"})]})]})]}),w?e.jsx("div",{className:"card",children:e.jsx("div",{className:"loading-indicator",children:"Loading souls…"})}):g===0?e.jsx("div",{className:"card",children:"No souls match that filter."}):u==="cards"?e.jsx("div",{className:"grid",children:p.map(s=>e.jsx(R,{soul:s,summaryFallback:"A SOUL.md bundle.",meta:e.jsxs("div",{className:"stat",children:["⭐ ",s.stats.stars," · ⤓ ",s.stats.downloads," · ",s.stats.versions," v"]})},s._id))}):e.jsx("div",{className:"skills-list",children:p.map(s=>e.jsxs(b,{className:"skills-row",to:"/souls/$slug",params:{slug:s.slug},children:[e.jsxs("div",{className:"skills-row-main",children:[e.jsxs("div",{className:"skills-row-title",children:[e.jsx("span",{children:s.displayName}),e.jsxs("span",{className:"skills-row-slug",children:["/",s.slug]})]}),e.jsx("div",{className:"skills-row-summary",children:s.summary??"SOUL.md bundle."})]}),e.jsxs("div",{className:"skills-row-metrics",children:[e.jsxs("span",{children:["⤓ ",s.stats.downloads]}),e.jsxs("span",{children:["★ ",s.stats.stars]}),e.jsxs("span",{children:[s.stats.versions," v"]})]})]},s._id))})]})}export{B as component};
