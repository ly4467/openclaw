import{c as Q,l as C,a as S,m as X,r as t,j as e}from"./main-BPgb0gzG.js";function D(x){if(!Number.isFinite(x))return"0 B";const j=["B","KB","MB","GB"];let n=x,c=0;for(;n>=1024&&c<j.length-1;)n/=1024,c+=1;return`${n.toFixed(n<10&&c>0?1:0)} ${j[c]}`}function Z(){const{isAuthenticated:x,isLoading:j,me:n}=Q(),c=C(S.githubImport.previewGitHubImport),$=C(S.githubImport.previewGitHubImportCandidate),R=C(S.githubImport.importGitHubSkill),M=X(),[h,U]=t.useState(""),[w,k]=t.useState([]),[q,I]=t.useState(null),[a,g]=t.useState(null),[u,o]=t.useState({}),[N,B]=t.useState(""),[b,P]=t.useState(""),[y,F]=t.useState("0.1.0"),[G,z]=t.useState("latest"),[H,r]=t.useState(null),[E,p]=t.useState(null),[d,m]=t.useState(!1),L=t.useMemo(()=>Object.values(u).filter(Boolean).length,[u]),K=t.useMemo(()=>{if(!a)return 0;let s=0;for(const l of a.files)u[l.path]&&(s+=l.size);return s},[a,u]),T=async()=>{p(null),r(null),g(null),k([]),I(null),o({}),m(!0);try{const l=(await c({url:h.trim()})).candidates??[];if(k(l),l.length===1){const i=l[0];i&&await A(i.path)}else r(`Found ${l.length} skills. Pick one.`)}catch(s){p(s instanceof Error?s.message:"Preview failed")}finally{m(!1)}},A=async s=>{p(null),r(null),g(null),o({}),I(s),m(!0);try{const l=await $({url:h.trim(),candidatePath:s});g(l),B(l.defaults.slug),P(l.defaults.displayName),F(l.defaults.version),z((l.defaults.tags??["latest"]).join(","));const i={};for(const v of l.files)i[v.path]=v.defaultSelected;o(i),r("Ready to import.")}catch(l){p(l instanceof Error?l.message:"Preview failed")}finally{m(!1)}},V=()=>{if(!a)return;const s=new Set(a.defaults.selectedPaths),l={};for(const i of a.files)l[i.path]=s.has(i.path);o(l)},W=()=>{if(!a)return;const s={};for(const l of a.files)s[l.path]=!0;o(s)},_=()=>{if(!a)return;const s={};for(const l of a.files)s[l.path]=!1;o(s)},O=async()=>{if(a){m(!0),p(null),r("Importing…");try{const s=a.files.map(f=>f.path).filter(f=>u[f]),l=G.split(",").map(f=>f.trim()).filter(Boolean),v=(await R({url:h.trim(),commit:a.resolved.commit,candidatePath:a.candidate.path,selectedPaths:s,slug:N.trim(),displayName:b.trim(),version:y.trim(),tags:l})).slug;r("Imported.");const J=n?.handle??(n?._id?String(n._id):"unknown");await M({to:"/$owner/$slug",params:{owner:J,slug:v}})}catch(s){p(s instanceof Error?s.message:"Import failed"),r(null)}finally{m(!1)}}};return x?e.jsxs("main",{className:"section upload-shell",children:[e.jsxs("div",{className:"upload-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"upload-kicker",children:"GitHub import"}),e.jsx("h1",{className:"upload-title",children:"Import from GitHub"}),e.jsx("p",{className:"upload-subtitle",children:"Public repos only. Detects SKILL.md automatically."})]}),e.jsxs("div",{className:"upload-badge",children:[e.jsx("div",{children:"Public only"}),e.jsx("div",{className:"upload-badge-sub",children:"Commit pinned"})]})]}),e.jsxs("div",{className:"upload-card",children:[e.jsx("div",{className:"upload-fields",children:e.jsxs("label",{className:"upload-field",htmlFor:"github-url",children:[e.jsxs("div",{className:"upload-field-header",children:[e.jsx("strong",{children:"GitHub URL"}),e.jsx("span",{className:"upload-field-hint",children:"Repo, tree path, or blob"})]}),e.jsx("input",{id:"github-url",className:"upload-input",value:h,onChange:s=>U(s.target.value),placeholder:"https://github.com/owner/repo",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1})]})}),e.jsxs("div",{className:"upload-footer",children:[e.jsx("button",{className:"btn btn-primary",type:"button",disabled:!h.trim()||d,onClick:()=>{T()},children:"Detect"}),H?e.jsx("p",{className:"upload-muted",children:H}):null]}),E?e.jsx("div",{className:"upload-validation",children:e.jsx("div",{className:"upload-validation-item upload-error",children:E})}):null]}),w.length>1?e.jsxs("div",{className:"card",children:[e.jsx("h2",{style:{margin:0},children:"Pick a skill"}),e.jsx("div",{className:"upload-filelist",children:w.map(s=>e.jsxs("label",{className:"upload-file",children:[e.jsx("input",{type:"radio",name:"candidate",checked:q===s.path,onChange:()=>{A(s.path)},disabled:d}),e.jsx("span",{className:"mono",children:s.path||"(repo root)"}),e.jsx("span",{children:s.name?s.name:s.description?s.description:""})]},s.path))})]}):null,a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upload-card",children:e.jsxs("div",{className:"upload-grid",children:[e.jsxs("div",{className:"upload-fields",children:[e.jsxs("label",{className:"upload-field",htmlFor:"slug",children:[e.jsxs("div",{className:"upload-field-header",children:[e.jsx("strong",{children:"Slug"}),e.jsx("span",{className:"upload-field-hint",children:"Unique, lowercase"})]}),e.jsx("input",{id:"slug",className:"upload-input",value:N,onChange:s=>B(s.target.value),autoCapitalize:"none",autoCorrect:"off",spellCheck:!1})]}),e.jsxs("label",{className:"upload-field",htmlFor:"name",children:[e.jsxs("div",{className:"upload-field-header",children:[e.jsx("strong",{children:"Display name"}),e.jsx("span",{className:"upload-field-hint",children:"Shown in listings"})]}),e.jsx("input",{id:"name",className:"upload-input",value:b,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"upload-row",children:[e.jsxs("label",{className:"upload-field",htmlFor:"version",children:[e.jsxs("div",{className:"upload-field-header",children:[e.jsx("strong",{children:"Version"}),e.jsx("span",{className:"upload-field-hint",children:"Semver"})]}),e.jsx("input",{id:"version",className:"upload-input",value:y,onChange:s=>F(s.target.value),autoCapitalize:"none",autoCorrect:"off",spellCheck:!1})]}),e.jsxs("label",{className:"upload-field",htmlFor:"tags",children:[e.jsxs("div",{className:"upload-field-header",children:[e.jsx("strong",{children:"Tags"}),e.jsx("span",{className:"upload-field-hint",children:"Comma-separated"})]}),e.jsx("input",{id:"tags",className:"upload-input",value:G,onChange:s=>z(s.target.value),autoCapitalize:"none",autoCorrect:"off",spellCheck:!1})]})]})]}),e.jsx("aside",{className:"upload-side",children:e.jsxs("div",{className:"upload-summary",children:[e.jsx("div",{className:"upload-requirement ok",children:"Commit pinned"}),e.jsxs("div",{className:"upload-muted",children:[a.resolved.owner,"/",a.resolved.repo,"@",a.resolved.commit.slice(0,7)]}),e.jsx("div",{className:"upload-muted mono",children:a.candidate.path||"repo root"})]})})]})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[e.jsx("h2",{style:{margin:0},children:"Files"}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",type:"button",disabled:d,onClick:V,children:"Select referenced"}),e.jsx("button",{className:"btn",type:"button",disabled:d,onClick:W,children:"Select all"}),e.jsx("button",{className:"btn",type:"button",disabled:d,onClick:_,children:"Clear"})]})]}),e.jsxs("div",{className:"upload-muted",children:["Selected: ",L,"/",a.files.length," • ",D(K)]}),e.jsx("div",{className:"file-list",children:a.files.map(s=>e.jsxs("label",{className:"file-row",children:[e.jsx("input",{type:"checkbox",checked:!!u[s.path],onChange:()=>o(l=>({...l,[s.path]:!l[s.path]})),disabled:d}),e.jsx("span",{className:"mono file-path",children:s.path}),e.jsx("span",{className:"file-meta",children:D(s.size)})]},s.path))}),e.jsx("div",{className:"upload-footer",children:e.jsx("button",{className:"btn btn-primary",type:"button",disabled:d||!N.trim()||!b.trim()||!y.trim()||L===0,onClick:()=>{O()},children:"Import + publish"})})]})]}):null]}):e.jsx("main",{className:"section",children:e.jsx("div",{className:"card",children:j?"Loading…":"Sign in to import and publish skills."})})}export{Z as component};
